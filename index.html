<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Roll Number Map with Google Maps and Leaflet</title>
    <!-- Leaflet.js CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
    <style>
        /* Style for the map */
        #map {
            height: 600px;
            width: 100%;
        }
    </style>
</head>
<body>

<h3>Find Your Exam Room Location</h3>
<input type="number" id="rollNumberInput" placeholder="Enter Roll Number">
<button onclick="findLocation()">Find Location</button>

<!-- Container for the map -->
<div id="map"></div>

<!-- Button to open Google Maps directions -->
<button id="directionButton" style="display:none;" onclick="openGoogleMaps()">Get Directions</button>

<!-- Leaflet.js JavaScript -->
<script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>

<script>
// Initialize the map with a default location (center of campus)
var map = L.map('map').setView([23.7805733, 90.2792399], 15);

// Google Maps tile layer
var googleMapsLayer = L.tileLayer(`https://mt1.google.com/vt/lyrs=r&x={x}&y={y}&z={z}&key=YOUR_GOOGLE_MAPS_API_KEY`, {
    maxZoom: 20,
    attribution: '&copy; <a href="https://www.google.com/maps">Google Maps</a>'
}).addTo(map);

// Replace "YOUR_GOOGLE_MAPS_API_KEY" with your actual Google Maps API Key
const googleSheetURL = 'https://docs.google.com/spreadsheets/d/e/YOUR_PUBLISHED_SHEET_ID/pub?output=csv';

// Fetch and parse Google Sheet data
let locations = [];
let selectedLocation = null; // Store the selected location for Google Maps redirection
fetch(googleSheetURL)
    .then(response => response.text())
    .then(csvText => {
        const rows = csvText.split("\n").slice(1); // Skip header row
        rows.forEach(row => {
            const [building, room, rollFrom, rollTo, lat, lng] = row.split(",");
            locations.push({
                building: building.trim(),
                room: room.trim(),
                rollFrom: parseInt(rollFrom),
                rollTo: parseInt(rollTo),
                lat: parseFloat(lat),
                lng: parseFloat(lng)
            });
        });
    });

// Function to find the location based on roll number input
function findLocation() {
    var rollNumber = document.getElementById("rollNumberInput").value;
    var found = false;

    locations.forEach(function (location) {
        if (rollNumber >= location.rollFrom && rollNumber <= location.rollTo) {
            // Clear previous markers
            map.eachLayer(function (layer) {
                if (layer instanceof L.Marker) {
                    map.removeLayer(layer);
                }
            });

            // Add marker for the found location
            var marker = L.marker([location.lat, location.lng]).addTo(map);
            marker.bindPopup(`<b>Building:</b> ${location.building}<br><b>Room:</b> ${location.room}`).openPopup();

            // Pan the map to the location
            map.setView([location.lat, location.lng], 17);
            
            // Store the selected location for the directions button
            selectedLocation = location;

            // Show the "Get Directions" button
            document.getElementById("directionButton").style.display = "block";

            found = true;
        }
    });

    if (!found) {
        alert("Roll number not found in the database.");
        // Hide the "Get Directions" button
        document.getElementById("directionButton").style.display = "none";
    }
}

// Function to open Google Maps with directions
function openGoogleMaps() {
    if (selectedLocation) {
        // Construct the Google Maps direction URL
        var googleMapsURL = `https://www.google.com/maps/dir/?api=1&destination=${selectedLocation.lat},${selectedLocation.lng}`;
        // Open the URL in a new tab or redirect the user
        window.open(googleMapsURL, '_blank');
    }
}
</script>

</body>
</html>
